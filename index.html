<!DOCTYPE html>
<html lang="dk" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Eksamensprojekt</title>
    <!-- Libraries -->
    <script src="Libraries/p5.js" charset="utf-8"></script>
    <script src="Libraries/p5.dom.js" charset="utf-8"></script>
    <!-- Scripts -->
    <script src="HID.js" charset="utf-8"></script>
    <script src="json.js" charset="utf-8"></script>
    <script src="pages.js" charset="utf-8"></script>
    <!-- Other -->
    <link rel="stylesheet" href="style.css">
  </head>
  <body oncontextmenu="return false;">
    <div class="frame">
      <script type="text/javascript">

        /* GENERAL */
        var anicontrol = 1      //Controls Automatic(play) and Step-bystep-mode
        var frame = 0           //Control variable for keeping track of animation (dias frame, not time)

        var hold = false        //Whether mouse is hold down
        var mouseRel = false    //For checking the mouse is released
        var pause = true       //True if mouseRel, but keeps true afterwards
        var active_button = ""  //Active UI button

        var dark = 50           //Default dark color
        var bright = 205        //Default bright color

        var area = {
          "H": 0,               //Browser height
          "W": 0,               //Browser width
          "h": 0,               //Animation-area height
          "w": 0,               //Animation-area width
          "C": {                //Center values for those;
            "H": 0,
            "W": 0,
            "h": 0,
            "w": 0,
          }
        }

        /* ATOM */
        var bColor = dark       //Background color
        var fColor = bright     //Foreground color
        var dir = true          //The direction for color fading (two-way = true/false)
        var title = "ANTI-MATTER"    //The title-text
        var ladning = "-"
        var ladningopp = "+"
        var l_offset = 9
        var atomSize = 1        //Or zoom size for the atom

        var grav = 1
        /* CODE TO BE EXECUTED ONCE ONLY AT START */
        function setup() {
          createCanvas(innerWidth,innerHeight)  //Create a HTML5 Canvas for the p5.js enviorment
          frameRate(20)                         //Set the frameRate

          area.H = windowHeight
          area.W = windowWidth
          area.h = windowHeight-20
          area.w = windowWidth-350
          area.C.H = windowHeight/2
          area.C.W = windowWidth/2
          area.C.h = (windowHeight-20)/2
          area.C.w = (windowWidth-350)/2
        }

        /* CODE TO BE EXECUTEDE REPEATLY */
        function draw() {
          frameSet()                                //Call frameSet (Check for anything new shall happen in the current frame)
          HID()
          UI()                                      //Call and update UI (User Interface and graphics)
          exerciseUI()

          noStroke()
          fill(dark)

          var cText = showtext()
          if(cText) {
            push()
            textAlign(LEFT)
            textSize(32)
            text(cText.Header, area.w+10, 30)
            textSize(18)
            text(cText.Content, area.w+10, 55, 320)
            if (cText.Extra) {
              text(cText.Extra, area.w+10, area.h-100, 330, 100)
            }
            pop()
          }
        }

        /* Checks if anything new shall be exectued in the current frame */
        function frameSet() {
          if (betw(-1, 50)) {
            startpage()
          } else if (betw(50, 200)) {  //If frame is inbetween 0 and 200 do:
            atom()                    //Call atom
          } else if (betw(75, 200)) { //If frame is inbetween 200 and 400 do:
            atom()
            quark()                   //And call quark
          } else if (betw(200, 300)) {
            forcet()
          } else if (betw(300, 400)) {
            collide()
          } else if (betw(400, 450)) {
            eequalmcsquared()
          }
        }

        function UI() {
          stroke(dark)
          fill(bright)
          rect(area.w,0,area.W/2,area.h)

          fill(dark)
          stroke(bright)
          strokeWeight(2)

          if (active_button == "START" || mouseIsPressed) {
            rect(area.W/4,area.h,area.W/4,area.H-area.h)
            rect(area.W/2,area.h,area.W/4,area.H-area.h)
            rect(area.W-area.W/4,area.h,area.W/4,area.H-area.h)
            fill(0,200,25)
            rect(0,area.h,area.W/4,area.H-area.h)
          } else if (active_button == "PREV") {
            rect(0,area.h,area.W/4,area.H-area.h)
            rect(area.W/4,area.h,area.W/4,area.H-area.h)
            rect(area.W-area.W/4,area.h,area.W/4,area.H-area.h)
            fill(150,150,25)
            rect(area.W/2,area.h,area.W/4,area.H-area.h)
          } else if (active_button == "NEXT") {
            rect(0,area.h,area.W/4,area.H-area.h)
            rect(area.W/4,area.h,area.W/4,area.H-area.h)
            rect(area.W/2,area.h,area.W/4,area.H-area.h)
            fill(150,150,25)
            rect(area.W-area.W/4,area.h,area.W/4,area.H-area.h)
          } else if (active_button == "PAUSE" && !mouseIsPressed || pause) {
            rect(0,area.h,area.W/4,area.H-area.h)
            rect(area.W/2,area.h,area.W/4,area.H-area.h)
            rect(area.W-area.W/4,area.h,area.W/4,area.H-area.h)
            fill(230,0,10)
            rect(area.W/4,area.h,area.W/4,area.H-area.h)
          }

          fill(255)
          noStroke()

          beginShape()    //Start arrow
          vertex(area.C.W/4, area.h+5)
          vertex(area.C.W/4+10, area.h+10)
          vertex(area.C.W/4, area.h+15)
          endShape(CLOSE)
          beginShape()    //Pause button
          vertex(area.C.W/1.35-5, area.h+5)
          vertex(area.C.W/1.35-1, area.h+5)
          vertex(area.C.W/1.35-1, area.h+15)
          vertex(area.C.W/1.35-5, area.h+15)
          endShape(CLOSE)
          beginShape()
          vertex(area.C.W/1.35+1, area.h+5)
          vertex(area.C.W/1.35+5, area.h+5)
          vertex(area.C.W/1.35+5, area.h+15)
          vertex(area.C.W/1.35+1, area.h+15)
          endShape(CLOSE)
          beginShape()    //Start step-arrow-back
          vertex(area.C.W*1.25-12, area.h+15)
          vertex(area.C.W*1.25-12, area.h+5)
          vertex(area.C.W*1.25-9, area.h+5)
          vertex(area.C.W*1.25-9, area.h+15)
          vertex(area.C.W*1.25, area.h+15)
          vertex(area.C.W*1.25-10, area.h+10)
          vertex(area.C.W*1.25, area.h+5)
          vertex(area.C.W*1.25, area.h+10)
          vertex(area.C.W*1.25-3, area.h+10)
          vertex(area.C.W*1.25+7, area.h+5)
          vertex(area.C.W*1.25+7, area.h+15)
          vertex(area.C.W*1.25-3, area.h+10)
          vertex(area.C.W*1.25, area.h+10)
          vertex(area.C.W*1.25, area.h+15)
          endShape(CLOSE)
          beginShape()    //Start step-arrow-forward
          vertex(area.C.W*1.75, area.h+15)
          vertex(area.C.W*1.75, area.h+10)
          vertex(area.C.W*1.75+3, area.h+10)
          vertex(area.C.W*1.75-7, area.h+15)
          vertex(area.C.W*1.75-7, area.h+5)
          vertex(area.C.W*1.75+3, area.h+10)
          vertex(area.C.W*1.75, area.h+10)
          vertex(area.C.W*1.75, area.h+5)
          vertex(area.C.W*1.75+10, area.h+10)
          vertex(area.C.W*1.75, area.h+15)
          vertex(area.C.W*1.75+9, area.h+15)
          vertex(area.C.W*1.75+9, area.h+5)
          vertex(area.C.W*1.75+12, area.h+5)
          vertex(area.C.W*1.75+12, area.h+15)
          endShape(CLOSE)

          fill(bright)
        }

        function exerciseUI() {

        }

        /* Self defined (comprimized) functions */
        function betw(low,high){if(frame>=low&&frame<high){return true}return false}
        function showtext(){for(var i=0;i<json.length;i++){if(json[i].from<=frame&&json[i].to>frame){return json[i]}}}
        function windowResized(){resizeCanvas(windowWidth,windowHeight);area.H = windowHeight;area.W = windowWidth;area.h = windowHeight-20;area.w = windowWidth-350;area.C.H = windowHeight/2;area.C.W = windowWidth/2;area.C.h = (windowHeight-20)/2;area.C.w = (windowWidth-350)/2}

        function animation_control(state) {
          if(state == "START") {
            anicontrol = setInterval(function() {
              console.log(frame)
              active_button = "START"
              frame+=0.25
            },25)
          } else if (state == "PAUSE") {
            active_button = "PAUSE"
            var interval_id = setInterval("", 9999) //Get a reference to the last
            for (var i = 1; i < interval_id; i++) { //Cycle throu all intervals
              clearInterval(i)                      //to clearing all intervals
            }
            setTimeout(function(){hold=false},1000)
            anicontrol = 1
          } else if (state == "NEXT") {
            var lastData = showtext()
            anicontrol = setInterval(function() {
              console.log(frame)
              active_button = "NEXT"
              if (lastData == showtext()) {
                frame+=0.25
              } else {
                animation_control("PAUSE")
              }
            },25)
          } else if (state == "PREV" && frame > 0) {
            var lastData = showtext()
            anicontrol = setInterval(function() {
              console.log(frame)
              if (lastData == showtext() || frame < 0) {
                active_button = "PREV"
                frame-=0.25
              } else {
                animation_control("PAUSE")
              }
            },25)
          }
        }
      </script>
    </div>
  </body>
</html>
